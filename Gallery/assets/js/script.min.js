const galleryInner=document.querySelector(".gallery__inner"),input=document.querySelector(".form__input"),btnLoad=document.querySelector(".btn-load"),btnDel=document.querySelector(".btn-del"),galleryForm=document.querySelector(".gallery-form"),drag=["dragenter","dragover","dragleave","drop"],dragEO=["dragenter","dragover"],dragLD=["dragenter","dragover"];let local,arr=[];function showGallery(){const e=document.createElement("div");document.createElement("div").classList.add("gallery-item"),e.classList.add("spiner"),galleryInner.appendChild(e),fetch("https://don16obqbay2c.cloudfront.net/frontend-test-task/gallery-images.json").then(e=>e.json()).then(l=>{for(key in l){for(elem in l[key]){const t=document.createElement("div"),a=document.createElement("img"),r=document.createElement("img");t.classList.add("gallery-item"),r.classList.add("gallery-item__placeholder"),r.src="http://placehold.it/180x135/2ecc71/ecf0f1",r.onload=()=>{e.style.display="none"},t.appendChild(r),a.classList.add("gallery-item__img"),t.appendChild(a),a.onload=()=>{r.style.display="none"},a.src=l[key][elem].url,galleryInner.appendChild(t)}localGet()}})}function localGet(){if(local=localStorage.getItem("arr"),local=JSON.parse(local),null!=local)for(let e=0;e<local.length;e++){console.log(local[e]);const l=document.createElement("div"),t=document.createElement("img");l.classList.add("gallery-item"),t.classList.add("gallery-item__img"),l.appendChild(t),t.src=local[e],galleryInner.appendChild(l),arr.push(local[e])}}function addImg(){const e=document.createElement("div"),l=document.createElement("img");if(""!=input.value){l.src=input.value;const t=document.createElement("img");e.classList.add("gallery-item"),t.classList.add("gallery-item__placeholder"),t.src="assets/images/8.jpg",e.appendChild(t),l.onload=function(){t.style.display="none",e.classList.add("gallery-item"),l.classList.add("gallery-item__img"),e.appendChild(l),galleryInner.appendChild(e),arr.push(input.value),localSet(),input.value=""},l.onerror=function(){document.querySelector(".form-error").innerHTML="Вставьте корректную ссылку на изображение!"}}else{document.querySelector(".form-error").innerHTML="Вставьте ссылку на изображение!"}}function localSet(){localStorage.setItem("arr",JSON.stringify(arr))}function selectImg(e){let l=e.target;l!=galleryInner&&(l.parentNode.classList.contains("active")?l.parentNode.classList.remove("active"):l.parentNode.classList.add("active"))}function removeImg(){const e=galleryInner.childNodes;for(let l=1;l<e.length;l++)e[l].classList.contains("active")&&e[l].remove()}function clearLS(){localStorage.clear()}function highlight(e){galleryForm.classList.add("bordercolor")}function unhighlight(e){galleryForm.classList.remove("bordercolor")}function preventDefaults(e){e.preventDefault(),e.stopPropagation()}function handlerDrop(e){handleFiles(e.dataTransfer.files)}function handleFiles(e){(e=[...e]).forEach(previewFile)}function previewFile(e){let l=new FileReader;console.log(l),l.readAsDataURL(e),l.onloadend=function(){const e=document.createElement("div"),t=document.createElement("img");e.classList.add("gallery-item"),t.classList.add("gallery-item__img"),t.src=l.result,e.appendChild(t),galleryInner.appendChild(e)}}["dragenter","dragover","dragleave","drop"].forEach(e=>{galleryForm.addEventListener(e,preventDefaults,!1)}),["dragenter","dragover"].forEach(e=>{galleryForm.addEventListener(e,highlight,!1)}),["dragleave","drop"].forEach(e=>{galleryForm.addEventListener(e,unhighlight,!1)}),galleryForm.addEventListener("drop",handlerDrop,!1),clearLS(),showGallery(),btnLoad.addEventListener("click",addImg),galleryInner.addEventListener("click",selectImg,!1),btnDel.addEventListener("click",removeImg);